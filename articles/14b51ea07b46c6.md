---
title: "ã€ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè£…ã®ç¬¬ä¸€æ­©ã€‘Vercel AI SDK ã®ãƒ„ãƒ¼ãƒ«æ©Ÿèƒ½ã‚’ä½¿ã„ã“ãªã™"
emoji: "ğŸ› ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Vercel AI SDK", "ãƒ„ãƒ¼ãƒ«", "Cursor Agent", "Next.js", "shadcn/ui"]
published: false
---

## Vercel AI SDK ã®ãƒ„ãƒ¼ãƒ«æ©Ÿèƒ½ã‚’ä½¿ã„ã“ãªã™

å‰å›ã®è¨˜äº‹ã§ã¯ã€Vercel AI SDK ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¨ã—ã¦ `useChat` ã¨ `streamText` ã®åŸºæœ¬æ©Ÿèƒ½ã‚’ç´¹ä»‹ã—ã¾ã—ãŸã€‚ä»Šå›ã¯ã€ã‚ˆã‚Šé«˜åº¦ãªæ©Ÿèƒ½ã§ã‚ã‚‹ã€Œãƒ„ãƒ¼ãƒ«ï¼ˆToolsï¼‰ã€ã®ä½¿ã„æ–¹ã‚’è§£èª¬ã—ã¾ã™ï¼

ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ã§ã€AI ã«ç‰¹å®šã®æ©Ÿèƒ½ã‚’å®Ÿè¡Œã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ä¾‹ãˆã°ã€æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã§ã®æ¤œç´¢ã€å¤–éƒ¨ API ã®å‘¼ã³å‡ºã—ãªã©ã€AI ã®èƒ½åŠ›ã‚’å¤§å¹…ã«æ‹¡å¼µã§ãã¾ã™ã€‚

### ãƒ„ãƒ¼ãƒ«ã¨ã¯ï¼Ÿ

ãƒ„ãƒ¼ãƒ«ã¨ã¯ã€AI ãƒ¢ãƒ‡ãƒ«ãŒå®Ÿè¡Œæ™‚ã«å‘¼ã³å‡ºã›ã‚‹é–¢æ•°ã®ã“ã¨ã§ã™ã€‚AI ãŒä¼šè©±ã®ä¸­ã§ã€Œã“ã®æƒ…å ±ãŒå¿…è¦ã ãªã€ã¨åˆ¤æ–­ã—ãŸã¨ãã€é©åˆ‡ãªãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã—ã¦æƒ…å ±ã‚’å–å¾—ã—ã€ãã®çµæœã‚’å…ƒã«ä¼šè©±ã‚’ç¶šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ä»¥ä¸‹ã®ç”»åƒã®ã‚ˆã†ã«ã€ã‚ã„ã•ã¤ã®ã¿ã§ã‚ã‚Œã°ãã®ã¾ã¾è¿”ä¿¡ã€æ¤œç´¢ãŒå¿…è¦ãªå ´åˆã¯æ¤œç´¢ãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã—ã¦æ¤œç´¢ã‚’è¡Œã„ã€ãã®çµæœã‚’å…ƒã«è¿”ä¿¡ã™ã‚‹ã¨ã„ã£ãŸå…·åˆã§ã™ã€‚

![ãƒ„ãƒ¼ãƒ«](/images/14b51ea07b46c6/01.png)

### ãƒ„ãƒ¼ãƒ«ã®åŸºæœ¬çš„ãªå®Ÿè£…æ–¹æ³•

ã¾ãšã¯ã€ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…ä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä»¥ä¸‹ã¯ç¾åœ¨ã®æ—¥ä»˜ã‚’å–å¾—ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã®ä¾‹ã§ã™ã€‚

```tsx
import { z } from "zod";

const getCurrentDateTool = {
  name: "getCurrentDate",
  description: "ç¾åœ¨ã®æ—¥ä»˜ã¨æ™‚åˆ»ã‚’å–å¾—ã—ã¾ã™",
  schema: z.object({}),
  execute: async () => {
    const now = new Date();
    return now.toLocaleString("ja-JP", {
      timeZone: "Asia/Tokyo",
      year: "numeric",
      month: "long",
      day: "numeric",
      hour: "numeric",
      minute: "numeric",
      weekday: "long",
    });
  },
};
```

### ãƒ„ãƒ¼ãƒ«ã‚’ API ãƒ«ãƒ¼ãƒˆã§ä½¿ç”¨ã™ã‚‹

æ¬¡ã«ã€ã“ã‚Œã‚‰ã®ãƒ„ãƒ¼ãƒ«ã‚’ API Route ã§ä½¿ç”¨ã—ã¾ã™ã€‚ä»Šå›ã¯ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã£ã¦ä»Šæ—¥ã®æ—¥ä»˜ã‚’å–å¾—ã—ã¦ã‹ã‚‰ç”Ÿæˆ AI ã«ã‚ˆã£ã¦ 3 æ—¥å¾Œã®æ—¥ä»˜ã‚’å‡ºåŠ›ã•ã›ã¾ã™ã€‚

ãƒ¢ãƒ‡ãƒ«ã«ã‚ˆã£ã¦ã¯ã“ã®è³ªå•ã¯è‹¦æ‰‹ã§ã€ä»Šå›ã® GPT-4o-mini ã§ã¯æ—¥ä»˜ãŒæ­£ã—ãè¿”ã£ã¦ãã¾ã›ã‚“ã€‚

![ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—](/images/14b51ea07b46c6/02.png)

```tsx
import { streamText } from "ai";
import { openai } from "@ai-sdk/openai";

export async function POST(req: Request) {
  const { messages } = await req.json();

  const stream = streamText({
    model: openai("gpt-4o-mini"),
    messages,
    tools: {
      getCurrentDate: getCurrentDateTool,
    },
    system:
      "ä½•ã‚’è¨€ã‚ã‚Œã¦ã‚‚3æ—¥å¾Œã®æ—¥ä»˜ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚ãŸã ã—ã€3æ—¥å¾Œã®æ—¥ä»˜ã‚’æ•™ãˆã‚‹ã®ã¿ã§ã€ãã‚Œä»¥å¤–ã®ã“ã¨ã¯ä¸€åˆ‡è¨€ã„ã¾ã›ã‚“ã€‚",
    maxSteps: 10, // maxSteps ã‚’è¨­å®šã—ãªã„ã¨ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã®ã¿ã§çµ‚äº†ã—ã¦ã—ã¾ã†
  });

  return stream.toDataStreamResponse();
}
```

ãƒ„ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦æ­£ã—ãæ—¥ä»˜ã‚’è¿”ã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

![ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—](/images/14b51ea07b46c6/03.png)

### æ¤œç´¢ãƒ„ãƒ¼ãƒ«ã®å®Ÿè£…

ã‚ˆã‚Šå®Ÿç”¨çš„ãªä¾‹ã¨ã—ã¦ã€æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã‚’ä½¿ã†ãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè£…ã—ã¦ã¿ã¾ã™ã€‚

```tsx
import { z } from "zod";

const serpapi = new SerpAPIClient();

export const serpTool = tool({
  description: "SerpAPIã‚’ä½¿ç”¨ã—ã¦æƒ…å ±ã‚’æ¤œç´¢ã™ã‚‹",
  parameters: z.object({ query: z.string() }),
  execute: async ({ query }) => {
    console.log(`ç”Ÿæˆã•ã‚ŒãŸæ¤œç´¢ã‚¯ã‚¨ãƒª: ${query}`);
    const res = await serpapi.search(query);
    return res;
  },
});
```

ã“ã®ãƒ„ãƒ¼ãƒ«ã¯ `query` ã¨ã„ã†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚AI ã¯ã“ã‚Œã‚‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’é©åˆ‡ã«è¨­å®šã—ã¦ãƒ„ãƒ¼ãƒ«ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

```tsx
export async function POST(req: Request) {
  const { messages } = await req.json();
  console.log(`User Message: ${messages[messages.length - 1].content}`);

  const stream = await streamText({
    model: openai("gpt-4o-mini"),
    messages,
    abortSignal: req.signal,
    tools: {
      serp: serpTool,
    },
    system: "è³ªå•ã«å¯¾ã—ã¦ã€SerpAPIã‚’ä½¿ç”¨ã—ã¦æƒ…å ±ã‚’æ¤œç´¢ã—ã¦å›ç­”ã—ã¦ãã ã•ã„ã€‚",
    maxSteps: 10,
  });

  return stream.toDataStreamResponse();
}
```

ä¾‹ãˆã°ã€ã€Œæ˜æ—¥ã®æ¸‹è°·ã®å¤©æ°—ã€ã¨ã„ã†ã®ã¯ã€ç”Ÿæˆ AI ã®ãƒ¢ãƒ‡ãƒ«è‡ªä½“ã«æƒ…å ±ã‚’æŒã£ã¦ã„ãªã„ãŸã‚ã€é€šå¸¸ã§ã¯å›ç­”ã§ãã¾ã›ã‚“ãŒã€ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ã§æ¤œç´¢ã‚’è¡Œã„ã€ãã®çµæœã‚’å…ƒã«å›ç­”ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

![ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—](/images/14b51ea07b46c6/04.png)

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®ãƒ„ãƒ¼ãƒ«ã®ä½¿ç”¨

è£å´ã§ã©ã®ã‚ˆã†ãªå‡¦ç†ã‚’è¡Œã£ã¦ã„ã‚‹ã‹ãŒã‚ã‹ã‚‹ã‚ˆã†ã«ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ãƒ„ãƒ¼ãƒ«ã®å®Ÿè¡ŒçŠ¶æ³ã‚’ç¢ºèªã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

```tsx
const getToolInfo = (): {
  toolStatusMessage: string | null;
} => {
  const lastToolPart = message.parts[message.parts.length - 1];

  if (lastToolPart.type !== "tool-invocation") {
    return { toolStatusMessage: null };
  }

  const toolName = lastToolPart.toolInvocation.toolName;

  let toolStatusMessage = "";
  switch (toolName) {
    case "serp":
      toolStatusMessage = "æƒ…å ±ã‚’æ¤œç´¢ä¸­...";
      break;
    default:
      break;
  }

  return {
    toolStatusMessage: toolStatusMessage,
  };
};
```

```tsx
{
  message.role === "assistant" && (
    <div className="flex items-center text-sm text-slate-600">
      {getToolInfo().toolStatusMessage && (
        <div className="flex items-center text-sm text-slate-600">
          <Loader2 className="mr-1 h-3 w-3 animate-spin" />
          {getToolInfo().toolStatusMessage}
        </div>
      )}
    </div>
  );
}
```

![ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—](/images/14b51ea07b46c6/05.png)

## ã¾ã¨ã‚

Vercel AI SDK ã®ãƒ„ãƒ¼ãƒ«æ©Ÿèƒ½ã‚’ä½¿ã†ã“ã¨ã§ AI ã®èƒ½åŠ›ã‚’å¤§å¹…ã«æ‹¡å¼µã§ãã¾ã™ã€‚åŸºæœ¬çš„ãªãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆã‹ã‚‰ã€è¤‡æ•°ã®ãƒ„ãƒ¼ãƒ«ã‚’çµ„ã¿åˆã‚ã›ãŸé«˜åº¦ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¾ã§ã€æ§˜ã€…ãªã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ç™ºã§ãã¾ã™ã€‚

- æœ€æ–°ã®æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ AI ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
- å¤–éƒ¨ API ã¨é€£æºã—ã¦å®Ÿéš›ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã§ãã‚‹ AI ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¿œã˜ã¦æ·±ã„èª¿æŸ»ã‚’è¡Œã†ãƒªã‚µãƒ¼ãƒã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ
- ãƒ‡ãƒ¼ã‚¿åˆ†æã‚„å¯è¦–åŒ–ã‚’è¡Œã† AI ã‚¢ãƒŠãƒªã‚¹ãƒˆ

Vercel AI SDK ã®ãƒ„ãƒ¼ãƒ«æ©Ÿèƒ½ã¯æ¯”è¼ƒçš„ç°¡å˜ã«å®Ÿè£…ã§ãã€ã¨ã¦ã‚‚ä¾¿åˆ©ãªã®ã§ãŠã™ã™ã‚ã§ã™ï¼
